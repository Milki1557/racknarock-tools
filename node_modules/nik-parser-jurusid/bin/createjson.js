#!/usr/bin/env node
import fs from "fs";
import { parse } from "csv-parse";

const file = "./wilayah.csv";

const propinsi = [];
const kokab = [];
const kecamatan = [];
// console.log(file.toString().length);

const createData = (folder) => {
  if (!fs.existsSync(folder)) {
    fs.mkdirSync(folder);
    console.log(`Folder ${folder} success is created`);
  }

  // fs.mkdir(`/${folder}`, { recursive: true }, (err) => {
  //   if (err) throw err;
  // });
  fs.createReadStream(file)
    .pipe(parse({ delimiter: ",", from_line: 1 }))
    .on("data", function (row) {
      const splitKode = row[0].split(".");

      if (splitKode.length === 1) {
        propinsi.push({
          kode: parseInt(row[0]),
          name: row[1],
        });
      }

      if (splitKode.length === 2) {
        kokab.push({
          kode: parseInt(splitKode.join("")),
          name: row[1],
        });
      }

      if (splitKode.length === 3) {
        kecamatan.push({
          kode: parseInt(splitKode.join("")),
          name: row[1],
        });
      }
    })
    .on("end", async () => {
      const propDoc = `export const prop = ${JSON.stringify(propinsi)};`;
      const kokabDoc = `export const kokab = ${JSON.stringify(kokab)};`;
      const kecDoc = `export const kec = ${JSON.stringify(kecamatan)};`;

      const isiDoc = `${propDoc}\n\n${kokabDoc}\n\n${kecDoc}`;

      fs.writeFile(`./${folder}/wilayah.js`, isiDoc, function (err) {
        if (err) console.log(err);
        console.log(
          `File wilayah is created successfully : ./${folder}/wilayah.json.`
        );
      });
    })
    .on("error", function (error) {
      console.log(error.message);
    });

  console.log("Success create data");
};

createData("data");
